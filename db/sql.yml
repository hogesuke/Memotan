# SQL
learning:
  count:
    enable_tag: select count(*) count from (select w.* from words w where user_id = :user_id) words inner join (select word_id from tags_words inner join (select id from tags where id = :tag_id and user_id = :user_id) tag on  tags_words.tag_id = tag.id) tags_words on  words.id = tags_words.word_id inner join learning_levels ll on  words.learning_level_id = ll.id inner join levelup_intervals li on  ll.level = li.learning_level where unix_timestamp (now()) - unix_timestamp (words.last_learned_at) < li.day_interval * 24 * 60 * 60
    disable_tag: select count(*) count from( select w.* from words w where user_id = :user_id ) words inner join learning_levels ll on  words.learning_level_id = ll.id inner join levelup_intervals li on  ll.level = li.learning_level where unix_timestamp(now()) - unix_timestamp(words.last_learned_at) < li.day_interval * 24 * 60 * 60
  words:
    enable_tag: select words.*, 'true' lv_up_chance from (select w.* from words w where user_id = :user_id) words inner join (select word_id from tags_words inner join (select id from tags where id = :tag_id and user_id = :user_id) tag on  tags_words.tag_id = tag.id) tags_words on  words.id = tags_words.word_id inner join learning_levels ll on  words.learning_level_id = ll.id inner join levelup_intervals li on  ll.level = li.learning_level where unix_timestamp (now()) - unix_timestamp (words.last_learned_at) < li.day_interval * 24 * 60 * 60 order by unix_timestamp(now()) - unix_timestamp(words.last_learned_at) desc limit :limit
    disable_tag: select words.*, 'true' lv_up_chance from( select w.* from words w where user_id = :user_id ) words inner join learning_levels ll on  words.learning_level_id = ll.id inner join levelup_intervals li on  ll.level = li.learning_level where unix_timestamp(now()) - unix_timestamp(words.last_learned_at) < li.day_interval * 24 * 60 * 60 order by unix_timestamp (now()) - unix_timestamp(words.last_learned_at) desc limit :limit

test:
  count:
    enable_tag: select count(*) count from (select w.* from words w where user_id = :user_id) words inner join (select word_id from tags_words inner join (select id from tags where id = :tag_id and user_id = :user_id) tag on  tags_words.tag_id = tag.id) tags_words on  words.id = tags_words.word_id inner join learning_levels ll on  words.learning_level_id = ll.id inner join levelup_intervals li on  ll.level = li.learning_level where unix_timestamp (now()) - unix_timestamp (words.last_learned_at) >= li.day_interval * 24 * 60 * 60
    disable_tag: select count(*) count from( select w.* from words w where user_id = :user_id ) words inner join learning_levels ll on  words.learning_level_id = ll.id inner join levelup_intervals li on  ll.level = li.learning_level where unix_timestamp(now()) - unix_timestamp(words.last_learned_at) >= li.day_interval * 24 * 60 * 60
  words:
    enable_tag: select words.*, 'false' lv_up_chance from ( select w.* from words w where user_id = :user_id ) words inner join ( select word_id from tags_words inner join ( select id from tags where id = :tag_id and user_id = :user_id ) tag on  tags_words.tag_id = tag.id ) tags_words on  words.id = tags_words.word_id inner join learning_levels ll on  words.learning_level_id = ll.id inner join levelup_intervals li on  ll.level = li.learning_level where unix_timestamp(now()) - unix_timestamp(words.last_learned_at) >= li.day_interval * 24 * 60 * 60 order by unix_timestamp (now()) - unix_timestamp (words.last_learned_at) desc limit :limit
    disable_tag: select words.*, 'false' lv_up_chance from( select w.* from words w where user_id = :user_id ) words inner join learning_levels ll on  words.learning_level_id = ll.id inner join levelup_intervals li on  ll.level = li.learning_level where unix_timestamp(now()) - unix_timestamp(words.last_learned_at) >= li.day_interval * 24 * 60 * 60 order by unix_timestamp(now()) - unix_timestamp(words.last_learned_at) desc limit :limit

